<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<title>Secure File Download</title>
<link rel="icon" href="favicon.ico">
<meta http-equiv="Content-Security-Policy" content="default-src 'self'; style-src 'self' 'unsafe-inline'; script-src 'self' 'unsafe-inline'; object-src 'none'; base-uri 'none';">
<style>
  *{box-sizing:border-box;margin:0;padding:0}
  body{font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,Arial,sans-serif;background:#f4f6f8;height:100vh;display:flex;align-items:center;justify-content:center}
  #card{background:#fff;padding:2rem 2.5rem;border-radius:1rem;box-shadow:0 10px 25px rgba(0,0,0,.1);width:100%;max-width:360px;text-align:center}
  h2{margin-bottom:1rem;color:#333;font-size:1.5rem}
  p{margin:0.75rem 0;color:#555;font-size:0.95rem}
  input{width:100%;padding:0.6rem 0.8rem;font-size:1rem;border:1px solid #ccd0d5;border-radius:0.5rem;outline:none}
  input:focus{border-color:#4a90e2}
  button{margin-top:1rem;width:100%;padding:0.6rem 0.8rem;font-size:1rem;border:none;border-radius:0.5rem;background:#4a90e2;color:#fff;cursor:pointer}
  button:disabled{opacity:0.6;cursor:not-allowed}
  #msg{color:#e53935;height:1.4rem}
  a.download-link{display:inline-block;margin-top:1rem;padding:0.6rem 0.8rem;background:#43a047;color:#fff;text-decoration:none;border-radius:0.5rem}
</style>
</head>
<body>
  <div id="card">
    <h2>受保护的下载</h2>
    <p>请输入下载密码（最多16位）</p>
    <input type="password" id="pwd" maxlength="16" placeholder="Password">
    <button id="confirm">验证并下载</button>
    <p id="msg"></p>
  </div>

<script>

function sha256(msg) {
  const utf8 = new TextEncoder().encode(msg);
  return crypto.subtle.digest('SHA-256', utf8).then(buf => {
    return Array.from(new Uint8Array(buf)).map(b => b.toString(16).padStart(2, '0')).join('');
  });
}


const CORRECT_HASH = '78aceaa9ed79c23c0f9502e0e5e5d9e7128e8a565fbf87bfb70edbfe0a0ff806';

const pwdInput = document.getElementById('pwd');
const btn = document.getElementById('confirm');
const msg= document.getElementById('msg');

btn.addEventListener('click', async () => {
  const value = pwdInput.value;
  if(!value){
    msg.textContent = '密码不能为空';
    return;
  }
  const hash = await sha256(value);
  if(hash === CORRECT_HASH){
    msg.style.color='#43a047';
    msg.textContent = '验证通过，开始下载…';
    const link = document.createElement('a');
    link.href = '2025.07.22.zip';
    link.download = '2025.07.22.zip';
    link.className = 'download-link';
    link.textContent = '点击如果未自动开始';
    document.getElementById('card').innerHTML = '<h2>验证通过</h2>';
    document.getElementById('card').appendChild(link);
    link.click();
  } else {
    msg.style.color='#e53935';
    msg.textContent = '密码错误，请重试';
    pwdInput.value='';
  }
});

pwdInput.addEventListener('keydown',e=>{
  if(e.key==='Enter') btn.click();
});
</script>
</body>
</html>
